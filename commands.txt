### Bam to fastqs
snakemake -s AN_WGS_script/snakemake_scripts/bam_to_fastq.snk --cores 1 -j 80 --cluster "sbatch -N 1 -t 6:00:00 --ntasks 80 --output=logs/%x_%j.log" --config input=20220401_axel_ccr/axel_bam_pipeline.tsv outdir=$SCRATCH/AN_WGS/20220401_axel_ccr --ri

### RNA-seq with Kraken
snakemake  --profile nichols_niagara  -s AN_WGS_script/run_rnaseq.snk  \
	--configfile AN_WGS_script/niagara_config_pez.yaml  \
	--config input=$SCRATCH/20230126_isgs_rnaseq/20230128.csv \
	outdir=/scratch/j/jmymryk/pez/20230126_isgs_rnaseq kraken=yes \
	--singularity-args " -B /scratch/j/jmymryk/pez,/scratch/j/jmymryk/pez/gdc_reference,$HOME "  \
	--group-components  fastqc=12 trim_galore=12 star=6 rsem=6 kraken=60 \
	--latency-wait 60 \
	--rerun-triggers input  --ri --keep-going

### run_wgs on Niagara
snakemake  --profile nichols_niagara  -s AN_WGS_script/run_wgs.snk  --configfile AN_WGS_script/niagara_config.yaml  \
	--config input=$SCRATCH/20221219_gillison/20230123.csv \
	outdir=$SCRATCH/20221219_gillison run_phylowgs=True \
	--singularity-args " -B /scratch/n/nicholsa/zyfniu,/scratch/n/nicholsa/zyfniu/gdc_reference,/scratch/n/nicholsa/zyfniu/20221219_gillison/reference,/scratch/n/nicholsa/zyfniu,$HOME "  \
	--groups bwa_mem=bwa_mem sort_sam_to_bam=sort_sam_to_bam \
	merge_bam_mapped_and_index=merge_bam_mapped_and_index markdup=markdup  \
	recalibrator=recalibrator gather_recal_tbl=recalibrator \
	ApplyBQSR=recalibrator  Merge_Recal_Bam=Merge_Recal_Bam  \
	samtools_stats=qc bamqc=qc  mutect2=mutect_single_variant_call \
	mutect2_all_tumours=mutect_together_variant_call  \
	read_counter=ichorcna ichorCNA=ichorcna \
	getHETsites_mpileup=getHETsites getAlleleCountsByChr=getHETsites \
	runTitanCNA=titan getHETsitesByChr=titan \
	selectSolution=titan copyOptSolution=titan ascat=ascat \
	--group-components  fastqc=12 bwa_mem=2 sort_sam_to_bam=6  \
	merge_bam_mapped_and_index=4 markdup=4 Merge_Recal_Bam=6  qc=10  \
	mutect_single_variant_call=100 mutect2_post_call=1  \
	mutect_together_variant_call=100 mutect2_all_post_call=1  \
	allelecount=50 ConvertAlleleCounts=10 ascat=10  manta_call=8 manta_annotate=10 \
	getHETsites=2 ichorcna=2 titan=2 ascat=20 \
	--rerun-triggers input  --ri --keep-going


### run_phylowgs on Niagara
snakemake  --profile nichols_niagara  -s AN_WGS_script/snakemake_scripts/titan_cna/wgs_phylowgs.snk  \
	--configfile AN_WGS_script/niagara_config.yaml \
	--config input=$SCRATCH/20221219_gillison/20230123.csv outdir=$SCRATCH/20221219_gillison \
	--rerun-triggers input \
	--group-components  phylowgs=4 \
	--keep-going \
	--ri

### run polyidus on Niagara
snakemake  --profile nichols_niagara  -s AN_WGS_script/snakemake_scripts/polyidus.snk  \
	--configfile AN_WGS_script/niagara_config.yaml \
	--config input=$SCRATCH/20221219_gillison/20230123.csv outdir=$SCRATCH/20221219_gillison \
	--rerun-triggers input \
	--group-components  polyidus=4 hpvviewer=4 hpv=40 \
	--ri

####
####  Graham
####

  ### run_wgs on graham
  #!/bin/bash
#SBATCH --mem-per-cpu=6000M
#SBATCH --cpus-per-task=1
#SBATCH --time=72:00:00
#SBATCH --job-name snakemake
#SBATCH --output=an_wgs_snakemake.txt

module purge
module load python/3.8
source ~/snakemake/bin/activate
module load singularity/3.8
snakemake --profile nichols_slurm \
        -s AN_WGS_script/run_wgs.snk \
        --config input=$SCRATCH/20221219_gillison/20230125_fastq.csv outdir=$SCRATCH/20221219_gillison \
	run_phylowgs=False \
        --unlock

snakemake --profile nichols_slurm \
	-s AN_WGS_script/run_wgs.snk \
	--config input=$SCRATCH/20221219_gillison/20230125_fastq.csv outdir=$SCRATCH/20221219_gillison \
	run_phylowgs=False \
	--groups bwa_mem=bwa_mem sort_sam_to_bam=sort_sam_to_bam \
	merge_bam_mapped_and_index=merge_bam_mapped_and_index markdup=markdup  \
	recalibrator=recalibrator gather_recal_tbl=recalibrator \
	ApplyBQSR=recalibrator  Merge_Recal_Bam=Merge_Recal_Bam  \
	samtools_stats=qc bamqc=qc  mutect2=mutect_single_variant_call \
	mutect2_all_tumours=mutect_together_variant_call  \
	read_counter=ichorcna ichorCNA=ichorcna \
	getHETsites_mpileup=getHETsites getAlleleCountsByChr=getHETsites \
	runTitanCNA=titan getHETsitesByChr=titan \
	selectSolution=titan copyOptSolution=titan ascat=ascat \
	--group-components  \
	mutect_single_variant_call=5 mutect2_post_call=20  \
	mutect_together_variant_call=5 mutect2_all_post_call=20  \
	allelecount=5 ConvertAlleleCounts=20 ascat=4  manta_call=1 manta_annotate=1 \
	getHETsites=2 ichorcna=2 titan=2  \
	--rerun-triggers input \
	--keep-going \
	--ri

	snakemake  --profile nichols_slurm  -s AN_WGS_script/snakemake_scripts/polyidus.snk  \
		--configfile AN_WGS_script/graham.yaml \
		--config input=$SCRATCH/20221219_gillison/20230123.csv outdir=$SCRATCH/20221219_gillison \
		--rerun-triggers input \
		--group-components  polyidus=4 hpvviewer=4 hpv=40 \
		--ri


  ### run phylowgs on Graham
